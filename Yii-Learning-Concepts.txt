Yii Learning Concepts
=====================
Yii, a generic framework that high-performance PHP framework - based on the MVC (Model-View-Controller) design pattern and provides a rich set of features to help developers build robust and scalable applications.

Yii is a component-based framework, which means that it is built around the concept of reusable components. This allows developers to create modular applications that can be easily extended and maintained.

Yii is also designed to be fast and efficient, with a focus on performance and scalability.
Features:
    1. caching
    2. lazy loading,
    3. optimized database access
    4. built-in support for AJAX,
    5, security features such as input validation and output filtering.
    6. support for multiple database types,
    7. support for multiple languages and localization,
    8. support for RESTful APIs,
    9. support for unit testing and behavior-driven development (BDD),
    10. support for code generation and scaffolding,
    11. support for web services and SOAP,
    12. support for third-party libraries and extensions,
    13. support for multiple authentication and authorization methods,
    14. support for multiple caching methods,
    15. support for multiple session management methods,
    16. support for multiple logging methods,

Yii supports two types of application - 
    1. web applications
    2. console applications


Application Structure
---------------------
Yii are built on MVC pattern architecture. It also have the following entities:
    a. Entry Scrips - responsible for starting a request handling cycle
    b. Application  - globally accessible objects that manange application components and coordinate them to fullfil request
    c. Components   - objects registered with applications and provide various fullfilling request
    d. Modules      - self-contained packages that contain complete MVC by themseves. Also an application can organized in terms of multiple components
    e. Filters      - a code that need to be invoked before and after the handling of each request by controllers.
    f. Widgets      - objects that can be embedded with Views, might can hold controllers logic and also reusuable in different views.



Yii Entry script
-----------------
Application are objects that govern the overall structure and lifecycle of Yii application. Each Yii application system contains a single
application object which is created in the entry script and globally accessible through the expression - \Yii::$app 

Its the first step of application bootstrapping process. Any application (web or console) has a single entry script. It basically instantiated
the application instance and forward it to the request.
    a. web          - has index.php file to serve web acceessibility
    b. contsole     - stored in "base path" of application named - yii and provided yii command facilities


Work of Entry script of Web
----------------------------
<?php

# 1. define global constants
defined('YII_DEBUG') or define('YII_DEBUG', true); 
defined('YII_ENV') or define('YII_ENV', 'dev');


// register Composer autoloader
require __DIR__ . '/../vendor/autoload.php';

// include Yii class file
require __DIR__ . '/../vendor/yiisoft/yii2/Yii.php';

// load application configuration
$config = require __DIR__ . '/../config/web.php';

// create, configure and run application
(new yii\web\Application($config))->run();

Entry Script of Console
------------------------
#!/usr/bin/env php
<?php
/**
 * Yii console bootstrap file.
 *
 * @link https://www.yiiframework.com/
 * @copyright Copyright (c) 2008 Yii Software LLC
 * @license https://www.yiiframework.com/license/
 */

# global constants
defined('YII_DEBUG') or define('YII_DEBUG', true);
defined('YII_ENV') or define('YII_ENV', 'dev');

// register Composer autoloader
require __DIR__ . '/vendor/autoload.php';

// include Yii class file
require __DIR__ . '/vendor/yiisoft/yii2/Yii.php';

// load application configuration
$config = require __DIR__ . '/config/console.php';

$application = new yii\console\Application($config);
$exitCode = $application->run();
exit($exitCode);

To access:
Syntax:
    Yii::$app->actionId; # here - actionId is the compenent, module etc


Components
----------
Components are the maining blocks of Yii applications. Components are instance of yii\base\Components or on extended classs.
Has 3 features to provide to classes:
    a. Properties
    b. Events
    c. Behaviours

These makes Yii classes much more customizable example- yii/jui/DatePicker an Interface(user) components which can be used in view to genrate a datepicker.

Code:
    use yii\jui\DatePicker;
    echo DatePicker::widget([
        'language' => 'ru',
        'name' => 'country',
        'clientOptions' => [
            'dateFormat' => 'yy-mm-dd',
        ]
    ]);

To called a component -
    a) web.php => has config setup which is a assertive array consists of different configuration setup - components : []
    b) define a compoents has  ways -
        1. in bootstrap : [ 'log', 'compoent_name'] # specifying compoents name
        2. declared a keyword- an associative array contains - 
            i. if have some properties setup -
                'compoent_name': [
                    'class' => 'app\path\ComponentName',
                    'other_prop' => true
                ]`
            ii. if have no property setup -
                'compoent_name': [
                    'class' => 'app\path\ComponentName',
                    'other_prop' => true
                ]
        3. create a closure - 
                'compoent_name' => function(){
                    return new \app\path\ComponentName;  # via returning an instance
                }

By default, components are lazy loaded a singletance which will only be used if get instantiated.


Core Application Components:
---------------------------
a. assetManager                 - manages asset bundles and asset publishing
b. db                           - represents db connection
c. errorHandler                 - handles PHP errors and exceptions
d. formatter                    - formats data displayed to end users
e. i18n                         - supports message translations and formatting
f. log                          - manage log targets
g. yii\swiftmailer\Mailer       - supports mail composing and sending
h. response                     - represent response sent to end users
i. request                      - represent request from end users
j. session                      - represent session information
k. urlManager                   - supports URL parsing and creation
l. user                         - represents user authentication
m. view                         - supports view rendering

Controllers:
-----------
Controllers is a class that is a middlepart of MVC which connects Model and Views. Controllers are based of actions.

Types of action:
    i)  inline action - prefix with 'action' word: are just method
        public function actionIndex(){
            return $this->render(view: index); // render a view
        }

    ii) standalone action - are classes what are used in multiple application or controllers purpose is to provide resuable components.

        public function actions(){
            // combination of ErrorAction and CaptchaAction classes
            return [
                'error' => [ // actionId
                    'class' => 'yii\web\ErrorAction', // value: array class configuration object
                ],
                'captcha' => [
                    'class' => 'yii\captcha\CaptchaAction',
                    'fixedVerifyCode' => Yii_ENVC_TEST ? 'test' : null,
                ]
            ]
        }

        Here - Each key is an actionId and the value is the array class configuration object

By default, any controller needs to extends from \yii\web\Controller - a base class of controller.

Note: 
a. inline action:
    i.  need to be public otherwise not inline
    ii. methods name are case-sensitive

b. standalone action:
    i.   are defined in terms of action classes extending - yii\base\Action or its child classes
    ii.  to use should declare it in the "action map" overidding the yii\base\Controller::actions() method
    iii. unlike inline action - action IDs for this can contain arbitrary chracters as long as they declared in the actions() method
    iv.  to create standlone action class - should extend yii\base\Action or a child classs and implements a public method named run()
         where the role of the run() method is similar to that of an action method.

         <?php
            namespace app\components;

            use yii\base\Action;

            class HelloWorldAction extends Action
            {
                public function run()
                {
                    return "Hello World";
                }
            }




Route Mapping In Controller - called Controller Class Namimg:
-------------------------------------------------------------

Single Word:
url : article/hello
route_mapping: article => Article => ArticleController

Double Word:
url: news-article/list-articles
route_mapping: news-article -> News-Article -> NewsArticle -> NewsArticleController -> app\controllers\NewsArticleController

Directory:
url: admin/post-comment 
route_mapping: admin/Post-Comment -> admin/PostComment -> admin/PostCommentController -> app\controllers\admin\PostCommentController;

Like - adminPanels/post-comment becomes app\controllers\adminPanels\PostCommentController.


Controller Mapping
------------------
Can configure the "controller map" to overcome the constraints of the controller IDs and class names. Useful when using third party controllers
and do not have controll over their class names.

configure controller map in the application configs:
    [
        'controllerMap' => [
            // declares "account" controller using a class name
            'account' => 'app\controllers\UserController',

            // declares "article" controller using a configuration array
            'article' => [
                'class' => 'app\controllers\PostController',
                'enableCsrfValidation' => false,
            ],
        ],
    ]

Default Controller
------------------
Each application has a default controller specified via the yii\base\Application::$defaultRoute property. 
When a request does not specify a route, the route specified by this property will be used.
For 
    a. Web      - 'site'
    b. Console  - 'help'

configure deafult controller in the application configs:
    [
        'defaultRoute' => 'main',
    ]

Action Parameters
-----------------
In Controller - both run() and inline methods can take paramters if does then called - Action Parameters. Where values are stored in $_GET(for web)
and can be obtained from request.

Example:

class PostController extends Controller
{
    public function actionView($id, $version = null)
    {
        // ...
    }
}

request is -  https://hostname/index.php?r=post/view&id=123 => $id = 123 and $version = null # thus not provided

Can also hint with type specifies -
class PostController extends Controller
{
    public function actionView($id, $version = null)
    {
        // ...
    }
}

request is: https://hostname/index.php?r=post/view&id[]=123 => $id = ['123'] and $version = null # thus not provided

Note: though the method expects $id paramter to be not null if request has no query string provided then it will through an exception.


Default Action
--------------
Each controller has a default action specified via - yii\base\Controller::$defaultAction property. 
When a route contains the controller ID only, it implies that the default action of the specified controller is requested.

By default, the default action is set as => $defaultAction = 'index'. Can be change through overidding the default value of this -

namespace app\controllers;
use yii\web\Controller;

class SiteController extends Controller
{
    public $defaultAction = 'home';

    public function actionHome()
    {
        return $this->render('home');
    }
}

Controller Lifecycle
---------------------
request is made and the controller is resolve then -
1. instance creted - yii\base\Controller::init();
2. create an action - if the actionId is provided in the route
3. default action - if actionId is not provided in the route and create a action for the default
4. actions() map - after having actionId search through mapping via actions() method which resolves if found then this, otherwise inline
5. inline action - if the actionId not found here also it goes for exception
6. InvalidRouteException - a class to provide exception handling

If actionId found and the action is created it sequentially called 3 things -

    1. Application::beforeAction - beforeAction() event
    2. Module::beforeAction 
    3. Controller::beforeAction


Here - If a controller is child class of another Controller it will called - parent controller first with beforeAction() and then child.

Note: Now if any of the sequential called failed and return it breaks the sequence.

Events Setup and Called
------------------------
config = [
    'on beforeAction' => function(){
        echo "<pre>";
        var_dump('Application beforeAction');
        echo "</pre>"
    }
    Yii::$app->controller->on(event_name: \yii\web\Controller::EVENT_BEFORE_ACTION, function(){
        echo "<pre>";
        var_dump('Controller before action on method');
        echo "</pre>"
    });
]

Routes
------
Routes are the things end users accessed which has folliwing parts:
    a. module ID        : exits only if controller belongs to non-application module
    b. controller ID    : a string that uniquely identifies controller among controllers within application
    c. action ID        : a string that uniquely identifies the action among other all actions within same controller   

Routes Format:
a. If not belongs to module -
    Syntax: 
        ControllerID/ActionID
b. If belongs to module -
    Syntax:
        ModuleID/ControllerID/ActionID

Example:
    if the request is - http://domain.com/index.php?r=site/index => SiteController/actionIndex



Models: yii\base\Model
------
Model are part of MVC architecture that are objects business data, logic and rules.

Model can be created via extending - yii/base/Model or its child classes which supports features like -
    a. Attributes           - represent the business data: access like - normal object or array
    b. Attributes Label     - specify the display labels for attributes
    c. Massive Assignment   - supports populating multiple attributes in a single step
    d. Rules(Validation)    - ensure input data based on the defined rules
    e. Data Exporting       - allow model data to be exported in terms of array with customizable formats

Example:
    <?php
        namespace app\models; # under app 
        use yii\base\Model;

        class ModelName extends Model{
            # properties
            public static $id;
            public $title = null;
            public $content = null;

            # rules
            public function rules(): array{
                return [
                    [['title'], 'required', 'string', 'max' => 200],
                    [['content'], 'required']
                ]
            }

            # attributes label
            public function attributesLabel(): array{
                return [
                    'id' => 'ID,
                    'content' => 'Content'
                ]
            }

            # relation
            public function getID(): void {
                return $this->hasOne(Article::class, []);
            }
        }



